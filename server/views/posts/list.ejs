<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 m-0">Bài viết</h1>
  <a class="btn btn-primary btn-sm" href="/admin/posts/new">Tạo bài viết mới</a>
</div>

<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Ảnh</th>
        <th>
          <a href="?sort=title&dir=<%= (sort==='title' && dir==='asc') ? 'desc' : 'asc' %>">
            Tiêu đề bài viết
          </a>
        </th>
        <th>Đường dẫn tĩnh</th>
        <th>Danh mục</th>
        <th>Tag</th>
        <th>Tác giả</th>
        <th>
          <a href="?sort=status&dir=<%= (sort==='status' && dir==='asc') ? 'desc' : 'asc' %>">
            Trạng thái
          </a>
        </th>
        <th>
          <a href="?sort=created_at&dir=<%= (sort==='created_at' && dir==='asc') ? 'desc' : 'asc' %>">
            Ngày tạo
          </a>
        </th>
        <th>
          <a href="?sort=scheduled_at&dir=<%= (sort==='scheduled_at' && dir==='asc') ? 'desc' : 'asc' %>">
            Lên lịch
          </a>
        </th>
        <th class="text-end">Hành động</th>
      </tr>
    </thead>
    <tbody>
      <% rows.forEach(r => { %>
        <tr>
          <td style="width:64px">
            <% if (r.featured_url) { %>
              <img src="<%= r.featured_url %>" style="width:48px;height:48px;object-fit:cover" class="rounded border">
            <% } %>
          </td>
          <td><strong><%= r.title || '(Chưa có tiêu đề)' %></strong></td>
          <td class="text-muted"><%= r.slug || '' %></td>
          <td><%= r.categories_text || '' %></td>
          <td><%= r.tags_text || '' %></td>
          <td><%= r.author || '' %></td>
          <td>
            <span class="badge bg-<%= r.status==='published'?'success':(r.status==='scheduled'?'warning':(r.status==='pending'?'secondary':'light')) %> text-dark">
              <%= r.status %>
            </span>
          </td>
          <td><%= r.created_at_fmt %></td>
          <td><%= r.scheduled_at_fmt %></td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-primary" href="/admin/posts/<%= r.id %>/edit">Sửa</a>
            <form action="/admin/posts/<%= r.id %>/trash" method="post" class="d-inline">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Chuyển bài viết vào Thùng rác?')">Xoá</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
