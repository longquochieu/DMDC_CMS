<!-- server/views/partials/tree.ejs -->
<% (nodes || []).forEach(function(node){ %>
  <li class="list-group-item" data-node-id="<%= node.id %>">
    <div class="d-flex align-items-center gap-2">
      <span class="draggable-handle" title="Kéo để đổi vị trí / đổi cha" style="cursor:grab;">⠿</span>

      <a href="/admin/<%= (typeof basePath !== 'undefined' && basePath ? basePath : 'pages') %>/<%= node.id %>/edit"
         class="node-title text-decoration-none">
        <%= node.title || '(Không tên)' %>
      </a>

      <% if (node.slug) { %>
        <small class="text-muted ms-2">/<%= node.slug %></small>
      <% } %>

      <form action="/admin/<%= (typeof basePath !== 'undefined' && basePath ? basePath : 'pages') %>/<%= node.id %>/trash"
            method="post" class="ms-auto d-inline">
        <input type="hidden" name="_csrf" value="<%= (typeof csrfToken !== 'undefined' ? csrfToken : '') %>">
        <button class="btn btn-xs btn-danger" onclick="return confirm('Chuyển vào thùng rác?')">
          <i class="fas fa-trash"></i>
        </button>
      </form>
    </div>

    <% if (node.children && node.children.length) { %>
      <ul class="list-group list-group-flush ms-4 mt-2">
        <%- include('../partials/tree', {
              nodes: node.children,
              basePath: (typeof basePath !== 'undefined' ? basePath : 'pages'),
              csrfToken: (typeof csrfToken !== 'undefined' ? csrfToken : '')
        }) %>
      </ul>
    <% } %>
  </li>
<% }); %>
