
<% include('../partials/flash') %>
<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header"><strong>Thông tin tài khoản</strong></div>
      <div class="card-body">
        <% if (message) { %><div class="alert alert-success"><%= message %></div><% } %>
        <% if (error) { %><div class="alert alert-danger"><%= error %></div><% } %>
        <form method="post" action="/admin/users/me">
          <div class="form-group">
            <label>Tên hiển thị</label>
            <input type="text" class="form-control" name="display_name" value="<%= (me && me.display_name) || '' %>">
          </div>
          <div class="form-group">
            <label>Email liên hệ</label>
            <input type="email" class="form-control" name="email" value="<%= (me && me.email) || '' %>" required>
          </div>
          <button class="btn btn-primary">Lưu</button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card">
      <div class="card-header"><strong>Ảnh đại diện</strong></div>
      <div class="card-body">
        <div class="mb-3">
          <% if (me && me.avatar_path) { %>
            <img src="<%= me.avatar_path %>" alt="avatar" class="img-thumbnail" style="width:96px;height:96px;object-fit:cover;">
          <% } else { %>
            <div class="text-muted">Chưa có ảnh đại diện</div>
          <% } %>
        </div>
        <form method="post" action="/admin/users/me/avatar" enctype="multipart/form-data">
          <div class="form-group">
            <input type="file" name="avatar" accept="image/*" required>
            <small class="form-text text-muted">Hỗ trợ: jpg/png/webp/svg. Tối đa 2MB.</small>
          </div>
          <button class="btn btn-secondary">Cập nhật ảnh</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header"><strong>Đổi mật khẩu</strong></div>
      <div class="card-body">
        <form method="post" action="/admin/users/me/password">
          <div class="form-group">
            <label>Mật khẩu hiện tại</label>
            <input type="password" class="form-control" name="current_password" required>
          </div>
          <div class="form-group">
            <label>Mật khẩu mới</label>
            <input type="password" class="form-control" name="new_password" minlength="8" required>
          </div>
          <div class="form-group">
            <label>Xác nhận mật khẩu mới</label>
            <input type="password" class="form-control" name="confirm_password" minlength="8" required>
          </div>
          <button class="btn btn-warning">Đổi mật khẩu</button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card">
      <div class="card-header"><strong>Phiên đăng nhập</strong></div>
      <div class="card-body">
        <p class="text-muted">Nhấn nút bên dưới để đăng xuất tất cả thiết bị (bao gồm phiên hiện tại).</p>
        <form method="post" action="/admin/users/me/logout-all">
          <button class="btn btn-outline-danger" onclick="return confirm('Bạn chắc chắn đăng xuất tất cả thiết bị?')">Đăng xuất tất cả</button>
        </form>
      </div>
    </div>
  </div>
</div>
